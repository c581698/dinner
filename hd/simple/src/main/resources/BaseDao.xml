<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.test.dao.BaseDao">
	<sql id="columns">
		a.id,
		a.shown_id,
		a.name,
		a.cate_id AS "cate.id",
		a.cate_ids,
		a.refer_price,
		a.sale_price,
		a.sal_sco_base,
		a.sal_sco_adv,
		a.rep_sco_base,
		a.rep_sco_adv,
		a.maintain_cycle,
		a.keywords,
		a.rep_time_a,
		a.rep_time_b,
		a.rep_time_c,
		a.rep_time_d,
		a.rep_time_e,
		a.rep_time_avg,
		a.is_eff,
		a.is_main,
		a.is_wechat,
		a.create_by AS
		"createBy.id",
		a.create_date,
		a.update_by AS "updateBy.id",
		a.update_date,
		a.remark,
		a.del_flag,
		a.pinyin,
		b.name AS "cate.name"
	</sql>

	<sql id="catejoin">
		left join serv_category b on a.cate_id = b.id
	</sql>

	<!-- 数据行数 -->
	<select id="count" resultType="java.lang.Integer">
		select
		count(0)
		from serv_item
		where
		del_flag = #[DEL_FLAG_NORMAL]
	</select>
	
	<select id="queryServs" resultMap="itemAndGoodCate">
		SELECT 
		  serv_item.*
		  ,serv_group_item.service_group_id refId  
		FROM serv_item 
		INNER JOIN serv_group_item ON (serv_group_item.service_header_id = serv_item.id)
		WHERE 
			serv_group_item.service_group_id IN (${ids})
	</select>
	<resultMap type="com.twtr.model.modules.basic.ServItem" id="itemAndGoodCate">
		<id property="id" column="id" />
		<result column="name" property="name"/>
		<result column="shown_id" property="shownId"/>
		<result column="cate_id" property="cate.id"/>
		<result column="cat.name" property="cat.name"/>
		<result column="rep_time_a" property="repTimeA"/>
		<result column="rep_time_b" property="repTimeB"/>
		<result column="rep_time_c" property="repTimeC"/>
		<result column="rep_time_d" property="repTimeD"/>
		<result column="rep_time_e" property="repTimeE"/>
		<result column="rep_time_avg" property="repTimeAvg"/>
		<result column="refer_price" property="referPrice"/>
		<collection property="goocates" javaType="ArrayList" column="id" ofType="com.twtr.model.modules.basic.GooCategory" select="selectCateByServ"/>
	</resultMap>
	<select id="selectCateByServ" resultType="com.twtr.model.modules.basic.GooCategory">
		select t.* from goo_category t 
			inner join serv_item_goocate sig on sig.cate_id = t.id and sig.serv_id = #{id}
	</select>
</mapper>